---
title: Latrodectus
classes: wide
ribbon: DodgerBlue
description: Latrodectus Analysis
categories:
  - Malware Analysis
toc: true
---

# Latrodectus Analysis

## **Overview**

This report is my brief analysis for the **Latrodectus loader**.

I will demonstrate the three "stages" of this sample, which can be decoded using a combination of regular expressions and CyberChef.  


## **IOCS**

The sample I used is javascript.  

**MD5**: ac220e1c5c5071a70f99a6a8200fe955



**SHA256**:
e31eaa04f39c59b97532303ae0cd41ddf8a24295bad8956d92b618b66bfecd1c

**Sample**: 
https://bazaar.abuse.ch/sample/e31eaa04f39c59b97532303ae0cd41ddf8a24295bad8956d92b618b66bfecd1c/



## **Initial Sample - Stage 1**


The initial sample is quite large at 713KB, which is big for a script-based file.
A sample of this size often suggests the presence of significant obfuscation or excessive junk code.

![[../../../assets/images/malware-analysis/Latrodectus/Pasted image 20241002112804.png]]

Since the file is JavaScript and text-based, the next step is to open it in a text editor for further analysis.

In the text editor, it's clear that the script is filled with a large number of junk comments, as shown by the mini-map on the right side.

The style of the junk comments indicates that they were generated from a wordlist, and were likely added by some form of obfuscator.

![[../../../assets/images/malware-analysis/Latrodectus/Pasted image 20241002113509.png]]

Using the highlighting feature in Visual Studio Code, we can scroll through the file to identify any real functional code.

Every few hundred lines, there is a small piece of functional javascript containing the actual malware functionality.

![[../../../assets/images/malware-analysis/Latrodectus/Pasted image 20241002113906.png]]


## **Cleaning Up the Code - Stage 2**

At this point, we have identified the obfuscation (junk comments) and confirmed that the file contains real code.

To deal with this, we can use a regular expression to remove the junk comments by targeting lines that start with double forward slashes.

This regular expression looks for double forward slashes followed by any characters and a newline. We have also added a caret (^) to ensure it only matches lines that begin with these slashes.

![[../../../assets/images/malware-analysis/Latrodectus/Pasted image 20241002114737.png]]


After applying the regular expression, we are left only with 52 lines of code.  

![[../../../assets/images/malware-analysis/Latrodectus/Pasted image 20241002141224.png]]

If we take a closer look at the code, we can see that it opens and reads its own contents, searching for any lines that start with 5 forward slashes.

![[../../../assets/images/malware-analysis/Latrodectus/Pasted image 20241002142830.png]]

This shows that not all the "junk" comments were useless; some contained code that made up the next part of the malicious script.

If we return to the original script, we can see that the lines containing 5 forward slashes contain code. 

![[../../../assets/images/malware-analysis/Latrodectus/Pasted image 20241002164923.png]]



## **Obtaining Stage 3**

At this stage, we know that another piece of malware is hidden within the comments of the original script.

Fortunately, we know the malicious code starts with 5 forward slashes, allowing us to use a regular expression to isolate those lines.

To extract this next stage, we can load the original script (including the junk comments) into CyberChef and apply a regular expression to capture the lines that begin with 5 forward slashes.

![[../../../assets/images/malware-analysis/Latrodectus/Pasted image 20241002172323.png]]

We used the "List capture groups" output format to display only the malicious code, avoiding the forward slashes. 


## **Review of Final Script**

On line 7 of the new script, we can see that the malware attempts install "vfs.msi" from remote server at http[:]//193[.]203[.]203[.]40/vfs[.]msi  

![[../../../assets/images/malware-analysis/Latrodectus/Pasted image 20241002173604.png]]


